machine:
  # START:LB
  # this section removes a restriction that allows CP's to use metallb and other LB configurations
  nodeLabels:
    node.kubernetes.io/exclude-from-external-load-balancers:
    $patch: delete
  # END:LB

  install:
    disk: /dev/vda
    wipe: true

  # START:OPENEBS
  # this section mounts /dev/vdb to /var/local, sets nr_hugepages, and labels the node as a place for
  # replicated storage (nodeLabel mayastor)
  disks:
    - device: /dev/vdb
      partitions:
        - mountpoint: /var/local
    - device: /dev/vdc
    
  sysctls:
    vm.nr_hugepages: "1024"
  
  nodeLabels:
    openebs.io/engine: "mayastor"
  
  kubelet:
    extraMounts:
      - destination: /var/local
        type: bind
        source: /var/local
        options:
          - bind
          - rshared
          - rw
  # END:OPENEBS
  
  certSANs:
    - talos-pa.domain.local
    - 10.6.64.20

  network:
    interfaces:
      - interface: ens3
        dhcp: true
        vip:
          ip: 10.6.64.20

    nameservers:
      - 10.0.1.11
      - 10.0.1.12
      - 10.0.1.13

  time:
    servers:
      - time.domain.local

cluster:
  allowSchedulingOnControlPlanes: true

  network:
    dnsDomain: cluster.local

  # START:OPENEBS
  apiServer:
    admissionControl:
      - name: PodSecurity
        configuration:
          apiVersion: pod-security.admission.config.k8s.io/v1beta1
          kind: PodSecurityConfiguration
          exemptions:
            namespaces:
              - openebs
  # END:OPENEBS

  
